<meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHREE RAM MARKET - рдкреНрд░реЛрдбрдХреНрдЯ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдЕрдкрдбреЗрдЯ | рдлрд╛рдЗрдирд▓ рдлрд┐рдХреНрд╕</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* ================== ЁЯОи CSS Styles: рдЕрдЯреНрд░реИрдХреНрдЯрд┐рд╡ рдбрд┐реЫрд╛рдЗрди ЁЯОи ================== */
:root {
  --primary-color: #ff5c33; /* рдирд╛рд░рдВрдЧреА/рд▓рд╛рд▓ (рдореБрдЦреНрдп рд░рдВрдЧ) */
  --secondary-color: #4CAF50; /* рд╣рд░рд╛ (рдбрд┐рд╕реНрдХрд╛рдЙрдВрдЯ/рд╕рдлрд▓рддрд╛) */
  --admin-color: #5D3FD3; /* рдмреИрдВрдЧрдиреА (рдПрдбрдорд┐рди/рдбрд┐рдЬрд╝рд╛рдЗрди) */
  --bg-color: #f7f7f7;
  --text-color: #333;
}

body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: var(--bg-color);
  color: var(--text-color);
}
.content-section {
    display: none; 
    padding: 20px;
    min-height: 80vh;
    padding-bottom: 70px;
}
/* ================== тмЖя╕П HEADER & NAV тмЖя╕П ================== */
header {
  background: var(--primary-color);
  color: white;
  text-align: center;
  padding: 15px;
  font-size: 24px;
  font-weight: bold;
  position: relative;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
#adminIcon {
  position: absolute;
  right: 15px;
  top: 15px;
  background: white;
  color: var(--primary-color);
  border-radius: 50%;
  padding: 5px 8px;
  font-weight: bold;
  cursor: pointer;
  line-height: 1;
  font-size: 14px;
  box-shadow: 0 0 5px rgba(0,0,0,0.2);
}
nav.top, nav.bottom {
  display: flex;
  justify-content: space-around;
  background: #fff;
  padding: 8px 0;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  z-index: 5;
  width: 100%;
}
nav.top { 
    position: sticky; 
    top: 0; 
}
nav.bottom {
  bottom: 0;
  position: fixed;
}
nav button {
  background: var(--primary-color);
  border: none;
  color: white;
  padding: 8px 12px;
  border-radius: 25px; 
  cursor: pointer;
  transition: 0.3s;
  font-size: 12px;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
nav button:hover { background: #ff784e; transform: translateY(-2px); }

/* ================== ЁЯза SMART LIST STYLES ЁЯза ================== */
#smartListContainer {
    background: #fff;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}
.smart-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}
#catalogAdminIcon {
    background: var(--admin-color);
    color: white;
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
}
#smartSearchInput {
    width: 100%;
    padding: 15px;
    border: 2px solid var(--primary-color);
    border-radius: 10px;
    box-sizing: border-box;
    font-size: 16px;
    margin-bottom: 5px;
}
.suggestions-box {
    border: 1px solid #ddd;
    border-top: none;
    border-radius: 0 0 10px 10px;
    max-height: 150px;
    overflow-y: auto;
    background: white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    margin-bottom: 15px;
    position: absolute; 
    width: calc(100% - 40px); 
    z-index: 10;
}
.suggestion-item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #eee;
    font-size: 14px;
    color: var(--text-color);
}
.suggestion-item:last-child { border-bottom: none; }
.suggestion-item:hover { background: #f0f0f0; }

#bulkOrderList {
    margin-top: 15px;
    border: 1px solid #eee;
    border-radius: 10px;
    padding: 10px;
    min-height: 50px;
    max-height: 300px;
    overflow-y: auto;
}
.bulk-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #fcfcfc;
    border-bottom: 1px dashed #eee;
    padding: 10px 0;
    font-size: 15px;
    transition: opacity 0.3s ease-in-out, max-height 0.3s ease-in-out, padding 0.3s ease-in-out; 
    max-height: 60px; 
    opacity: 1; 
    overflow: hidden; 
}
.bulk-item:last-child { border-bottom: none; }
.item-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}
.item-controls input[type="number"] {
    width: 50px;
    padding: 5px;
    text-align: center;
    margin: 0;
}
.item-controls .unit-display {
    width: 40px;
    text-align: right;
    font-size: 12px;
    color: #555;
}
.item-controls .delete-btn {
    background: none;
    border: none;
    color: #D32F2F;
    cursor: pointer;
    font-weight: bold;
    padding: 5px;
}
#orderSummaryBox {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 2px solid var(--secondary-color);
    font-size: 18px;
    font-weight: 700;
    color: var(--text-color);
}
#grandTotalDisplay {
    color: var(--primary-color);
    font-size: 1.2em;
}

/* ================== ЁЯУж PRODUCT GRID (YouTube Style) ================== */
#productContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
  gap: 20px; 
  padding: 0px; 
}
.product {
  background: white;
  padding: 0; 
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  text-align: left; 
  transition: transform 0.3s, box-shadow 0.3s;
  border: 1px solid #eee;
  overflow: hidden; 
}
.product:hover { transform: translateY(-5px); box-shadow: 0 8px 15px rgba(0,0,0,0.15); }
.product img {
  width: 100%;
  height: 150px; 
  object-fit: cover; 
  margin-bottom: 0; 
  display: block;
  cursor: pointer; 
}
.product-details {
    padding: 12px;
}
.product-details h4 {
    font-size: 16px;
    font-weight: 700;
    margin: 0 0 8px 0;
    color: #222;
    cursor: pointer; 
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.price-box {
  margin-bottom: 10px;
  font-weight: 600;
}
.original-price {
    color: #999;
    font-size: 0.8em;
    text-decoration: line-through;
    display: block;
}
.discounted-price {
    color: var(--secondary-color);
    font-size: 1.2em;
    display: block;
    cursor: pointer; 
}
.discount-badge {
    background: var(--secondary-color);
    color: white;
    padding: 3px 6px;
    border-radius: 5px;
    font-size: 0.75em;
    margin-bottom: 10px; 
    display: inline-block;
}
button.order-btn {
  margin-top: 5px;
  background: var(--primary-color);
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  width: 100%; 
  box-sizing: border-box;
}
button.order-btn:hover { background: #ff784e; }
/* ================== (CSS рдЕрдкрдбреЗрдЯ рдкреВрд░рд╛ рд╣реБрдЖ) ================== */


/* Dynamic Order Styles */
.order-summary {
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    margin-top: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    border-left: 5px solid var(--primary-color);
}
.order-summary h4 {
    margin-top: 0;
    color: var(--primary-color);
}
/* ================== ЁЯУЭ MODAL & FORMS ЁЯУЭ ================== */
.modal-overlay {
  display: none;
  background: rgba(0,0,0,0.7);
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  overflow-y: auto;
}
.form-box {
  background: white;
  padding: 25px;
  border-radius: 15px;
  width: 90%;
  max-width: 450px;
  margin: 50px auto;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
}
input:not([type="number"]), select, textarea {
  width: 100%;
  margin-bottom: 12px;
  padding: 12px;
  border: 1px solid #ddd;
  border-radius: 10px;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}
input[type="file"] {
    padding: 5px; 
}
button.action-btn {
  background: var(--primary-color);
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 5px;
  font-weight: 600;
}
button.action-btn:hover { background: #ff784e; }
button.close-btn {
  background: #ccc;
  color: var(--text-color);
  margin-left: 10px;
}
button.close-btn:hover { background: #bbb; }
/* Admin Specific */
#adminMenu button {
    width: 100%;
    margin-bottom: 10px;
    padding: 12px;
    font-size: 16px;
    font-weight: 600;
}
#printOrders { background: #00796B; } 
#addProdBtn { background: var(--secondary-color); } 
#delProdBtn { background: #D32F2F; } 
#updateOrderStatusBtn { background: #FF9800; } /* NEW Color */
#removeOrderBtn { background: #9C27B0; }
#catalogSettingsBtn { background: #00AEEF; } 
/* ================== ЁЯУЭ Buy Product List Section Styles ЁЯУЭ ================== */
.buy-list-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}
.buy-list-card textarea {
    min-height: 250px;
    font-size: 16px;
    line-height: 1.6;
    border: 2px solid var(--primary-color);
}


/* ================== тмЗя╕П FOOTER тмЗя╕П ================== */
footer {
  background: var(--text-color);
  color: white;
  text-align: center;
  padding: 15px;
  margin-top: 20px;
}
</style>
</head>
<body>

<header>
  SHREE RAM MARKET ЁЯЫТ (рд╢реНрд░реА рд░рд╛рдо рдорд╛рд░реНрдХреЗрдЯ)
  <div id="adminIcon">ЁЯФС</div>
</header>

<nav class="top">
  <button onclick="showSection('home-section')">ЁЯПа рд╣реЛрдо (Home)</button>
  <button onclick="showSection('buy-list-section')">ЁЯУЭ Buy Product List</button> 
  <button onclick="showSection('help-section')">тЭУ рд╕рд╣рд╛рдпрддрд╛ (Help)</button>
  <button onclick="showSection('privacy-section')">ЁЯУЬ рдЧреЛрдкрдиреАрдпрддрд╛-рд╢рд░реНрддреЗрдВ (Privacy-T&C)</button>
</nav>

<div id="main-content-area">
    
    <div class="content-section" id="home-section" style="display: block;">
        
        <div class="smart-list-header">
            <h2>ЁЯЫТ рдЗрдВрд╕реНрдЯреЗрдВрдЯ рдЧреНрд░реЛрд╕рд░реА рд▓рд┐рд╕реНрдЯ (Instant Grocery List)</h2>
            <div id="catalogAdminIcon" onclick="openAdminCatalogModal()">ЁЯФС рдХреИрдЯрд▓реЙрдЧ рдРрдб/рдкреНрд░рд╛рдЗрд╕ (Admin)</div>
        </div>
        <div id="smartListContainer">
            
            <input 
                type="text" 
                id="smartSearchInput" 
                placeholder="рдкреНрд░реЛрдбрдХреНрдЯ рдХрд╛ рдирд╛рдо рд▓рд┐рдЦреЗрдВ (e.g., рдЪреАрдиреА, рдЖрдЯрд╛, рдкрдиреАрд░)" 
                autocomplete="off"
                oninput="showSuggestions()"
            >
            <div id="searchSuggestions" class="suggestions-box"></div>
            
            <div id="bulkOrderList">
                <p id="emptyListMsg" style="text-align:center; color:#888; padding: 20px;">рд▓рд┐рд╕реНрдЯ рдЦрд╛рд▓реА рд╣реИред рдЖрдЗрдЯрдо рдЬреЛрдбрд╝рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВред</p>
            </div>

            <div id="orderSummaryBox">
                <p>рдХреБрд▓ рдпреЛрдЧ (Total Price): <span id="grandTotalDisplay">тВ╣0.00</span></p>
                <button 
                    id="proceedToOrderBtn" 
                    class="action-btn" 
                    onclick="openFinalOrderModal('smart')" 
                    style="width:100%; margin-top:15px; background:var(--secondary-color);"
                >
                    рдСрд░реНрдбрд░ рдФрд░ рдкрддрд╛ рднрд░реЗрдВ (Proceed to Order Form)
                </button>
            </div>
        </div>
        
        <h2>рдЕрдкрд▓реЛрдб рдХрд┐рдП рдЧрдП рдкреНрд░реЛрдбрдХреНрдЯреНрд╕ (Uploaded Products)</h2>
        <div id="productContainer"></div>
    </div>
    
    <div class="content-section" id="buy-list-section">
        <h2>ЁЯУЭ Buy Product List</h2>
        <p>рдпрд╣рд╛рдВ рдЖрдк рдЕрдкрдиреА рдЬрд░реВрд░рдд рдХреЗ **800** рдкреНрд░реЛрдбрдХреНрдЯ рдирд╛рдо рддрдХ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред рдХреГрдкрдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рдЖрдЗрдЯрдо рдХреЛ рдПрдХ рдирдИ рд▓рд╛рдЗрди рдореЗрдВ рд▓рд┐рдЦреЗрдВред</p>
        <div class="buy-list-card">
            <textarea 
                id="freeFormList" 
                placeholder="рдЙрджрд╛. (Example):&#10;1kg рдЪреАрдиреА&#10;500g рдзрдирд┐рдпрд╛ рдкрд╛рдЙрдбрд░&#10;3 рдкреАрд╕ рд▓рд╛рдЗрдлрдмреЙрдп рд╕рд╛рдмреБрди&#10;..."
                maxlength="8000"
                oninput="calculateFreeFormTotal()" ></textarea>
            
            <p style="font-size: 18px; font-weight: 700; margin-top: 15px;">
                рдЕрдиреБрдорд╛рдирд┐рдд рдХреБрд▓ рдпреЛрдЧ (Estimated Total): 
                <span id="freeFormTotalDisplay" style="color: var(--primary-color);">тВ╣0.00</span>
            </p>
            <button 
                id="proceedToFreeFormOrderBtn" 
                class="action-btn" 
                onclick="openFinalOrderModal('freeform')" 
                style="width:100%; margin-top:15px; background:var(--primary-color);"
            >
                рдСрд░реНрдбрд░ рдлреЙрд░реНрдо рдкрд░ рдЬрд╛рдПрдБ (Proceed to Order Form)
            </button>
        </div>
    </div>
    <div class="content-section" id="orders-section">
        <h2>ЁЯУж рдЖрдкрдХреЗ рдСрд░реНрдбрд░реНрд╕ (Your Orders)</h2>
        <p>рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд┐рдЫрд▓реЗ рдФрд░ рд╡рд░реНрддрдорд╛рди рдСрд░реНрдбрд░реНрд╕ рдХреА рд╕реНрдерд┐рддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрдЧреАред</p>
        <div id="myOrdersContainer">
            </div>
    </div>
    
    <div class="content-section" id="help-section">
        <h2>тЭУ рд╕рд╣рд╛рдпрддрд╛ рдХреЗрдВрджреНрд░ (Help Center)</h2>
        <p>рдХрд┐рд╕реА рднреА рд╕рдорд╕реНрдпрд╛ рдХреЗ рд▓рд┐рдП 24/7 рдХрд╕реНрдЯрдорд░ рд╕рдкреЛрд░реНрдЯред</p>
        <p>рдореЛрдмрд╛рдЗрд▓: 9905826407 | рдИрдореЗрд▓: help@shreerammarket.com</p>
    </div>

    <div class="content-section" id="privacy-section">
        <h2>ЁЯУЬ рдЧреЛрдкрдиреАрдпрддрд╛ рдиреАрддрд┐ рдФрд░ рдирд┐рдпрдо рд╡ рд╢рд░реНрддреЗрдВ (Privacy & T&C)</h2>
        <p>рдЖрдкрдХреА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЬрд╛рдирдХрд╛рд░реА рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИред рд╣рдорд╛рд░реЗ рдирд┐рдпрдо рд╡ рд╢рд░реНрддреЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рдкреЭреЗрдВред</p>
    </div>
    
    <div class="content-section" id="notes-section">
        <h2>ЁЯУЭ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдиреЛрдЯреНрд╕ (Important Notes)</h2>
        <p>рдмрд╛рдЬрд╛рд░ рдореЗрдВ рдирдП рдСрдлрд░ рдФрд░ рддрд╛рдЬрд╝рд╛ рдЦрд╝рдмрд░реЗрдВ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ!</p>
        <div style="background:#fff; padding:15px; border-radius:10px; margin-top:15px;">
            <h4>рдирдпрд╛! рдСрд░реНрдЧреЗрдирд┐рдХ рд╕рдмреНрдЬрд┐рдпрд╛рдБ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ! (Organic Veggies Available!)</h4>
            <p>рдЖрдЬ рд╕реЗ рд╣рдордиреЗ рдЕрдкрдиреА рд╕реВрдЪреА рдореЗрдВ рддрд╛рдЬрд╝реА рдСрд░реНрдЧреЗрдирд┐рдХ рд╕рдмреНрдЬрд┐рдпрд╛рдБ рдЬреЛрдбрд╝реА рд╣реИрдВред</p>
        </div>
    </div>

    <div class="content-section" id="delivery-section">
        <h2>ЁЯЪЪ рдбрд┐рд▓реАрд╡рд░реА рдХреА рдЬрд╛рдирдХрд╛рд░реА (Delivery Information)</h2>
        <p>рд╣рдо 24-48 рдШрдВрдЯреЛрдВ рдХреЗ рднреАрддрд░ рдбрд┐рд▓реАрд╡рд░реА рдХрд░рддреЗ рд╣реИрдВред рдбрд┐рд▓реАрд╡рд░реА рдХрд╛ рд╕рдордп рд╕реБрдмрд╣ 9 рдмрдЬреЗ рд╕реЗ рд╢рд╛рдо 6 рдмрдЬреЗ рддрдХ рд╣реИред</p>
    </div>
</div>

<nav class="bottom">
  <button onclick="showSection('notes-section')">ЁЯУЭ рдиреЛрдЯреНрд╕ (Notes)</button>
  <button onclick="showSection('orders-section'); loadMyOrders();">ЁЯУж рдСрд░реНрдбрд░реНрд╕ (Orders)</button>
  <button onclick="showSection('delivery-section')">ЁЯЪЪ рдбрд┐рд▓реАрд╡рд░реА рдХрдм рд╣реЛрдЧреА (Delivery Info)</button>
</nav>

<div class="modal-overlay" id="orderFormModal">
  <div class="form-box">
    <h3 id="orderTitle">рдСрд░реНрдбрд░ рдлреЙрд░реНрдо (Order Form)</h3>
    <p id="modalPriceRow">
        рдореВрд▓реНрдп (Price): <span id="modalPriceDisplay"></span>
        <span id="singleQtyUnitSelector">
            <input type="number" id="custQuantity" placeholder="рдорд╛рддреНрд░рд╛" min="1" value="1" style="width: 60px; margin: 0 5px; padding: 5px;" required>
            <select id="unitSelector" style="width: 80px; padding: 5px; margin: 0; display: inline-block;">
                <option value="Piece">Piece</option>
            </select>
        </span>
    </p>
    
    <div id="bulkOrderSummaryInModal" style="margin-bottom: 15px; padding: 10px; border: 1px dashed #ccc; display:none;">
        <h4 style="margin-top:0;">рдЖрдкрдХрд╛ рдЧреНрд░реЛрд╕рд░реА рдСрд░реНрдбрд░ (Your Grocery Order)</h4>
        <div id="bulkOrderDetailsList"></div>
        <p style="font-weight:bold; margin-bottom:0;">рдХреБрд▓ рдмрд┐рд▓ (Total Bill): <span id="modalBulkTotalDisplay"></span></p>
    </div>

    <div id="freeFormListSummaryInModal" style="margin-bottom: 15px; padding: 10px; border: 1px dashed #ccc; display:none;">
        <h4 style="margin-top:0;">рдЖрдкрдХреА рдЦрд░реАрджрджрд╛рд░реА рд╕реВрдЪреА (Your Product List)</h4>
        <p style="font-size: 14px; white-space: pre-wrap;" id="modalFreeFormListDisplay"></p>
        <p style="font-weight:bold; margin-bottom:0;">рдЕрдиреБрдорд╛рдирд┐рдд рдмрд┐рд▓ (Estimated Bill): 
            <span id="modalFreeFormPriceDisplay" style="color: var(--primary-color);">тВ╣0.00</span>
        </p>
        <p style="font-weight:bold; margin-bottom:0; color: #D32F2F;" id="freeFormTBDMessage">
            *рдиреЛрдЯ: рдпрд╣ рдореВрд▓реНрдп рдЕрдиреБрдорд╛рдирд┐рдд рд╣реИред рдЕрдВрддрд┐рдо рдореВрд▓реНрдп рдбрд┐рд▓реАрд╡рд░реА рдХреЗ рд╕рдордп рдмрддрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред (Final price will be confirmed upon delivery.)
        </p>
    </div>


    <input type="text" id="custName" placeholder="рдкреВрд░рд╛ рдирд╛рдо (Full Name)" required>
    <input type="tel" id="custMobile" placeholder="рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ (Mobile Number)" required>
    <input type="text" id="custFlat" placeholder="рдлреНрд▓реИрдЯ/рд░реВрдо/рд╣рд╛рдЙрд╕ рдирдВрдмрд░ (Flat/House No.)" required>
    <input type="text" id="custVillage" placeholder="рдЧрд╛рдВрд╡/рд╢рд╣рд░ рдХрд╛ рдирд╛рдо (Village/City Name)" required>
    <input type="text" id="custDistrict" placeholder="рдЬрд┐рд▓рд╛ (District)" required>
    
    <select id="custState" required>
        <option value="">рд░рд╛рдЬреНрдп рдЪреБрдиреЗрдВ (Select State)</option>
        <option value="AP">рдЖрдВрдзреНрд░ рдкреНрд░рджреЗрд╢ (Andhra Pradesh)</option>
        <option value="AR">рдЕрд░реБрдгрд╛рдЪрд▓ рдкреНрд░рджреЗрд╢ (Arunachal Pradesh)</option>
        <option value="AS">рдЕрд╕рдо (Assam)</option>
        <option value="BR">рдмрд┐рд╣рд╛рд░ (Bihar)</option>
        <option value="CT">рдЫрддреНрддреАрд╕рдЧрдврд╝ (Chhattisgarh)</option>
        <option value="GA">рдЧреЛрд╡рд╛ (Goa)</option>
        <option value="GJ">рдЧреБрдЬрд░рд╛рдд (Gujarat)</option>
        <option value="HR">рд╣рд░рд┐рдпрд╛рдгрд╛ (Haryana)</option>
        <option value="HP">рд╣рд┐рдорд╛рдЪрд▓ рдкреНрд░рджреЗрд╢ (Himachal Pradesh)</option>
        <option value="JH">рдЭрд╛рд░рдЦрдВрдб (Jharkhand)</option>
        <option value="KA">рдХрд░реНрдирд╛рдЯрдХ (Karnataka)</option>
        <option value="KL">рдХреЗрд░рд▓ (Kerala)</option>
        <option value="MP">рдордзреНрдп рдкреНрд░рджреЗрд╢ (Madhya Pradesh)</option>
        <option value="MH">рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ (Maharashtra)</option>
        <option value="MN">рдордгрд┐рдкреБрд░ (Manipour)</option>
        <option value="ML">рдореЗрдШрд╛рд▓рдп (Meghalaya)</option>
        <option value="MZ">рдорд┐рдЬреЛрд░рдо (Mizoram)</option>
        <option value="NL">рдирд╛рдЧрд╛рд▓реИрдВрдб (Nagaland)</option>
        <option value="OR">рдУрдбрд┐рд╢рд╛ (Odisha)</option>
        <option value="PB">рдкрдВрдЬрд╛рдм (Punjab)</option>
        <option value="RJ">рд░рд╛рдЬрд╕реНрдерд╛рди (Rajasthan)</option>
        <option value="SK">рд╕рд┐рдХреНрдХрд┐рдо (Sikkim)</option>
        <option value="TN">рддрдорд┐рд▓рдирд╛рдбреБ (Tamil Nadu)</option>
        <option value="TS">рддреЗрд▓рдВрдЧрд╛рдирд╛ (Telangana)</option>
        <option value="TR">рддреНрд░рд┐рдкреБрд░рд╛ (Tripura)</option>
        <option value="UP">рдЙрддреНрддрд░ рдкреНрд░рджреЗрд╢ (Uttar Pradesh)</option>
        <option value="UK">рдЙрддреНрддрд░рд╛рдЦрдВрдб (Uttarakhand)</option>
        <option value="WB">рдкрд╢реНрдЪрд┐рдо рдмрдВрдЧрд╛рд▓ (West Bengal)</option>
        <option value="AN">рдЕрдВрдбрдорд╛рди рдФрд░ рдирд┐рдХреЛрдмрд╛рд░ рджреНрд╡реАрдк рд╕рдореВрд╣ (A&N Islands)</option>
        <option value="CH">рдЪрдВрдбреАрдЧрдврд╝ (Chandigarh)</option>
        <option value="DN">рджрд╛рджрд░рд╛ рдФрд░ рдирдЧрд░ рд╣рд╡реЗрд▓реА рдФрд░ рджрдорди рдФрд░ рджреАрд╡ (DNH & DD)</option>
        <option value="DL">рджрд┐рд▓реНрд▓реА (Delhi/NCT)</option>
        <option value="JK">рдЬрдореНрдореВ рдФрд░ рдХрд╢реНрдореАрд░ (Jammu and Kashmir)</option>
        <option value="LD">рд▓рдХреНрд╖рджреНрд╡реАрдк (Lakshadweep)</option>
        <option value="LA">рд▓рджреНрджрд╛рдЦ (Ladakh)</option>
        <option value="PY">рдкреБрдбреБрдЪреЗрд░реА (Puducherry)</option>
    </select>
    <input type="text" id="custPincode" placeholder="рдкрд┐рди рдХреЛрдб (Pincode)" required>
    
    <button id="confirmOrder" class="action-btn" style="width: 100%;">рдСрд░реНрдбрд░ рдХрдиреНрдлрд░реНрдо рдХрд░реЗрдВ (Confirm Order)</button>
    <button onclick="closeModal('orderFormModal')" class="action-btn close-btn" style="width: 100%; margin-top: 10px;">рдмрдВрдж рдХрд░реЗрдВ (Close)</button>
  </div>
</div>

<div class="modal-overlay" id="adminPanelModal">
  <div class="form-box" id="loginBox">
    <h3>ЁЯФТ рдПрдбрдорд┐рди рд▓реЙрдЧрд┐рди (Admin Login)</h3>
    <input type="password" id="adminPass" placeholder="рдкрд╛рд╕рд╡рд░реНрдб рдбрд╛рд▓рд┐рдП (Password)">
    <button id="loginBtn" class="action-btn">рд▓реЙрдЧрд┐рди (Login)</button>
    <button onclick="closeModal('adminPanelModal')" class="action-btn close-btn">рдмрдВрдж рдХрд░реЗрдВ (Close)</button>
  </div>
  
  <div class="form-box" id="adminMenu" style="display:none;">
    <h3>ЁЯСС Admin Control (рдорд╛рд▓рд┐рдХ/Creator)</h3>
    <p>рдбреЗрдЯрд╛ рдЕрдм **рд╣рдореЗрд╢рд╛ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡** рд░рд╣реЗрдЧрд╛ред</p>
    <button id="printOrders" class="action-btn">ЁЯз╛ рдирдП рдСрд░реНрдбрд░реНрд╕ рдкреНрд░рд┐рдВрдЯ рдХрд░реЗрдВ (Print New Orders)</button><br>
    <button id="updateOrderStatusBtn" class="action-btn">ЁЯФД рдСрд░реНрдбрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдмрджрд▓реЗрдВ (Update Order Status)</button><br>
    <button id="catalogSettingsBtn" class="action-btn" onclick="openAdminCatalogModal()">ЁЯУЭ рдмрд▓реНрдХ рдХреИрдЯрд▓реЙрдЧ рдореИрдиреЗрдЬ рдХрд░реЗрдВ (Manage Bulk Catalog)</button><br>
    <button id="addProdBtn" class="action-btn">ЁЯУж рдкреНрд░реЛрдбрдХреНрдЯ рдЬреЛрдбрд╝реЗрдВ/рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ (Add Product with Photo)</button><br>
    <button id="delProdBtn" class="action-btn">тЭМ рдкреНрд░реЛрдбрдХреНрдЯ рд╣рдЯрд╛рдПрдВ (Delete Product)</button><br>
    <button id="removeOrderBtn" class="action-btn" style="background: #9C27B0;">ЁЯЧСя╕П рдСрд░реНрдбрд░ рд╣рдЯрд╛рдПрдВ (Remove Order)</button><br>
    <button onclick="adminLogout()" class="action-btn close-btn">ЁЯЪк рд▓реЙрдЧрдЖрдЙрдЯ (Logout)</button>
  </div>
</div>

<div class="modal-overlay" id="adminCatalogModal">
    <div class="form-box">
        <h3>ЁЯУЭ рдмрд▓реНрдХ рдХреИрдЯрд▓реЙрдЧ рдореИрдиреЗрдЬ рдХрд░реЗрдВ (Manage Bulk Catalog)</h3>
        <p>рдпрд╣ рд╕реВрдЪреА рд╕реНрдорд╛рд░реНрдЯ рд╕рд░реНрдЪ рдФрд░ Buy Product List рдХреЗ рд▓рд┐рдП рд╣реИред</p>
        <input type="text" id="newCatProdName" placeholder="рдЙрддреНрдкрд╛рдж рдХрд╛ рдирд╛рдо (рд╣рд┐рдВрджреА/English)" required>
        <input type="number" id="newCatProdPrice" placeholder="рдХреАрдордд (тВ╣) рдкреНрд░рддрд┐ рдпреВрдирд┐рдЯ" required>
        
        <select id="newCatProdUnit" required>
            <option value="Kg">Kg (рдХрд┐рд▓реЛрдЧреНрд░рд╛рдо)</option>
            <option value="Ltr">Ltr (рд▓реАрдЯрд░)</option>
            <option value="Piece">Piece (рдкреАрд╕)</option>
        </select>

        <input type="text" id="newCatProdAliases" placeholder="рд╕рд░реНрдЪ рдХреЗ рд▓рд┐рдП рд╢рдмреНрдж (e.g., sugar, cheeni) - рдХреЙрдорд╛ рд╕реЗ рдЕрд▓рдЧ рдХрд░реЗрдВ" value="">

        <button id="confirmAddCatalogProd" class="action-btn" style="background:var(--admin-color);">рдХреИрдЯрд▓реЙрдЧ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ (Add to Catalog)</button>
        <button id="removeCatProdBtn" class="action-btn" style="background:#D32F2F;">тЭМ рдХреИрдЯрд▓реЙрдЧ рдкреНрд░реЛрдбрдХреНрдЯ рд╣рдЯрд╛рдПрдВ (Delete Catalog Item)</button>
        <button onclick="closeModal('adminCatalogModal')" class="action-btn close-btn">рдмрдВрдж рдХрд░реЗрдВ (Close)</button>
        <p style="margin-top: 15px; font-size: 12px; color: #555;">рд╡рд░реНрддрдорд╛рди рдХреИрдЯрд▓реЙрдЧ рдореЗрдВ рдЖрдЗрдЯрдо: <span id="catalogCount">0</span></p>
    </div>
</div>

<div class="modal-overlay" id="addProductModal">
    <div class="form-box">
        <h3>ЁЯУж рдирдпрд╛ рдкреНрд░реЛрдбрдХреНрдЯ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ (Upload New Product with Photo)</h3>
        <p style="font-size: 12px; color: var(--primary-color);">рдиреЛрдЯ: рдлреЛрдЯреЛ рднреА рдЕрдм **рд╣рдореЗрд╢рд╛ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡** рд░рд╣реЗрдЧреАред</p>
        <input type="text" id="newProdName" placeholder="рдЙрддреНрдкрд╛рдж рдХрд╛ рдирд╛рдо (Product Name)" required>
        
        <label style="display:block; text-align:left; font-size:14px; color:#555; margin-top:10px;">ЁЯУ╕ рдкреНрд░реЛрдбрдХреНрдЯ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ (Upload Photo)</label>
        <input type="file" id="newProdFile" accept="image/*" required>
        <input type="number" id="newProdOriginalPrice" placeholder="рдореВрд▓ рдХреАрдордд (тВ╣) рдкреНрд░рддрд┐ рдпреВрдирд┐рдЯ/рдкреАрд╕" required>
        
        <input type="number" id="newProdDiscount" placeholder="рдбрд┐рд╕реНрдХрд╛рдЙрдВрдЯ (%) рдЦреБрдж рджреЗрдВрдЧреЗ (Discount %)" value="0">
        <select id="newProdUnit" required>
            <option value="Kg">Kg (рдХрд┐рд▓реЛрдЧреНрд░рд╛рдо)</option>
            <option value="Ltr">Ltr (рд▓реАрдЯрд░)</option>
            <option value="Piece">Piece (рдкреАрд╕)</option>
        </select>
        <button id="confirmAddProd" class="action-btn">рдкреНрд░реЛрдбрдХреНрдЯ рдЬреЛрдбрд╝реЗрдВ (Add Product)</button>
        <button onclick="closeModal('addProductModal')" class="action-btn close-btn">рдмрдВрдж рдХрд░реЗрдВ (Close)</button>
    </div>
</div>

<div class="modal-overlay" id="updateStatusModal">
    <div class="form-box">
        <h3>ЁЯФД рдСрд░реНрдбрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдмрджрд▓реЗрдВ (Update Order Status)</h3>
        <input type="text" id="updateOrderId" placeholder="рдСрд░реНрдбрд░ ID (e.g., HB101)" required>
        <select id="newStatusSelector" required>
            <option value="">рдирдИ рд╕реНрдерд┐рддрд┐ рдЪреБрдиреЗрдВ</option>
            <option value="New Order">New Order (рдирдпрд╛ рдСрд░реНрдбрд░)</option>
            <option value="ЁЯЪЪ рдбрд┐рд▓реАрд╡рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдХрд▓рд╛">ЁЯЪЪ Out for Delivery (рдбрд┐рд▓реАрд╡рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдХрд▓рд╛)</option>
            <option value="тЬЕ рдкреВрд░рд╛ рд╣реБрдЖ">тЬЕ Completed (рдкреВрд░рд╛ рд╣реБрдЖ)</option>
            <option value="тЭМ рдХреИрдВрд╕рд┐рд▓">тЭМ Cancelled (рдХреИрдВрд╕рд┐рд▓)</option>
        </select>
        <button id="confirmStatusUpdate" class="action-btn" style="background:#FF9800;">рд╕реНрдерд┐рддрд┐ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ</button>
        <button onclick="closeModal('updateStatusModal')" class="action-btn close-btn">рдмрдВрдж рдХрд░реЗрдВ (Close)</button>
    </div>
</div>
<footer>┬й 2025 SHREE RAM MARKET | рдбреЗрдЯрд╛ рдЕрдм **рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ** рдЖрдкрдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╕реЗрд╡ рд░рд╣реЗрдЧрд╛ред</footer>

<script>
/* ================== ЁЯФТ рдПрдбрдорд┐рди рдкрд╛рд╕рд╡рд░реНрдбреНрд╕ ЁЯФТ ================== */
const MAIN_ADMIN_PASS = "fhfi439"; // рдореБрдЦреНрдп рдПрдбрдорд┐рди рдкреИрдирд▓
const CATALOG_ADMIN_PASS = "igu568"; // рдЧреНрд░реЛрд╕рд░реА рдХреИрдЯрд▓реЙрдЧ рдореИрдиреЗрдЬрдореЗрдВрдЯ

/* ================== ЁЯУж рдбрдореА рдбреЗрдЯрд╛рдмреЗрд╕ рд╕рд┐рдореБрд▓реЗрд╢рди рдФрд░ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рд▓реЙрдЬрд┐рдХ ЁЯУж ================== */
let products = []; 
let orders = [];
let productCatalog = []; 
let smartBulkList = []; 
let currentOrderingProduct = null;
let currentOrderType = 'single'; 

const productContainer = document.getElementById("productContainer");

// --- Default Data (рдЕрдЧрд░ localStorage рдЦрд╛рд▓реА рд╣реЛ рддреЛ) ---
const DEFAULT_CATALOG = [
    { id: 1001, name: "рдЪреАрдиреА (Sugar)", unit: "Kg", price: 42.00, aliases: ["sugar", "cheeni", "chini"] },
    { id: 1003, name: "рдЖрдЯрд╛ (Atta)", unit: "Kg", price: 35.00, aliases: ["atta", "wheat", "aata"] },
    { id: 1006, name: "рдкрдиреАрд░ (Paneer)", unit: "Kg", price: 320.00, aliases: ["paneer", "cheese"] },
    { id: 1007, name: "рджреВрдз (Milk - 1 Ltr)", unit: "Ltr", price: 60.00, aliases: ["milk", "doodh"] },
    { id: 1009, name: "рджрд╛рд▓ (Daal - Arhar)", unit: "Kg", price: 110.00, aliases: ["daal", "pulse", "arhar"] },
    { id: 1010, name: "рдЪрд╛рдп рдкрддреНрддреА (Tea)", unit: "Kg", price: 300.00, aliases: ["tea", "chai", "patti"] }
];
const DEFAULT_ORDERS = [
    { id: 'HB101', product: 'Sample Product 1 (Demo)', qty: '10 Kg', name: 'рд░рд╛рдо рд╕рд┐рдВрд╣', mobile: '9876543210', address: 'рдкрддрд╛ рдХрд╛ рдирдореВрдирд╛', total: 322.00, status: 'ЁЯЪЪ рдбрд┐рд▓реАрд╡рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдХрд▓рд╛' },
];

// тнР NEW: рдбреЗрдЯрд╛ рдХреЛ рд▓реЛрдХрд▓ рд╕реНрдЯреЛрд░реЗрдЬ рдореЗрдВ рд╕реЗрд╡ рдХрд░рдиреЗ рдХрд╛ рдлрдВрдХреНрд╢рди
function saveData() {
    localStorage.setItem('shreeram_products', JSON.stringify(products));
    localStorage.setItem('shreeram_catalog', JSON.stringify(productCatalog));
    localStorage.setItem('shreeram_orders', JSON.stringify(orders));
}

// тнР NEW: рдбреЗрдЯрд╛ рдХреЛ рд▓реЛрдХрд▓ рд╕реНрдЯреЛрд░реЗрдЬ рд╕реЗ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдлрдВрдХреНрд╢рди
function loadData() {
    const storedProducts = localStorage.getItem('shreeram_products');
    const storedCatalog = localStorage.getItem('shreeram_catalog');
    const storedOrders = localStorage.getItem('shreeram_orders');

    // 1. Products Load
    if (storedProducts) {
        products = JSON.parse(storedProducts);
    } 

    // 2. Catalog Load (Use default if nothing is stored)
    if (storedCatalog) {
        productCatalog = JSON.parse(storedCatalog);
    } else {
        productCatalog = DEFAULT_CATALOG;
        saveData(); // Save defaults once
    }

    // 3. Orders Load (Use default if nothing is stored)
    if (storedOrders) {
        orders = JSON.parse(storedOrders);
    } else {
        orders = DEFAULT_ORDERS;
        saveData(); // Save defaults once
    }
}


/* ================== рд╕реНрдорд╛рд░реНрдЯ рд▓рд┐рд╕реНрдЯ рдлрдВрдХреНрд╢рди (No Change) ================== */
function calculateTotal() {
    let grandTotal = 0;
    smartBulkList.forEach(item => {
        const product = productCatalog.find(p => p.id === item.productID);
        if (product && item.qty > 0) {
            item.total = product.price * item.qty;
            grandTotal += item.total;
        } else {
             item.total = 0;
        }
    });
    document.getElementById("grandTotalDisplay").innerText = `тВ╣${grandTotal.toFixed(2)}`;
    return grandTotal;
}

function renderSmartList() {
    const listContainer = document.getElementById("bulkOrderList");
    const existingItems = Array.from(listContainer.querySelectorAll('.bulk-item'));
    
    existingItems.forEach(div => {
        const productID = parseInt(div.getAttribute('data-id'));
        if (!smartBulkList.some(item => item.productID === productID)) {
            div.style.opacity = '0';
            div.style.maxHeight = '0';
            div.style.padding = '0';
            div.style.border = 'none';
            setTimeout(() => div.remove(), 300); 
        }
    });

    smartBulkList.forEach(item => {
        const product = productCatalog.find(p => p.id === item.productID);
        if (!product) return; 

        let div = listContainer.querySelector(`.bulk-item[data-id="${product.id}"]`);

        if (!div) {
            div = document.createElement('div');
            div.classList.add('bulk-item');
            div.setAttribute('data-id', product.id);
            div.style.opacity = '0'; 
            div.style.maxHeight = '0';
            div.style.padding = '0 0'; 

            div.innerHTML = `
                <span class="item-name" title="${product.name}">${product.name.length > 25 ? product.name.substring(0, 25) + '...' : product.name}</span>
                <div class="item-controls">
                    <input 
                        type="number" 
                        min="1" 
                        value="${item.qty}" 
                        oninput="updateQuantity(${product.id}, this.value)"
                        style="width: 60px;"
                    >
                    <span class="unit-display">${product.unit}</span>
                    <span class="item-price" style="font-weight:600; min-width: 60px;">тВ╣${(product.price * item.qty).toFixed(2)}</span>
                    <button class="delete-btn" onclick="removeItemFromList(${product.id})">тЬЦ</button>
                </div>
            `;
            listContainer.appendChild(div);
            setTimeout(() => { 
                div.style.opacity = '1'; 
                div.style.maxHeight = '60px'; 
                div.style.padding = '10px 0'; 
            }, 10);
            
        } else {
            div.querySelector('input[type="number"]').value = item.qty;
            div.querySelector('.item-price').innerText = `тВ╣${(product.price * item.qty).toFixed(2)}`;
        }
    });

    if (smartBulkList.length === 0) {
        document.getElementById("emptyListMsg").style.display = 'block';
        document.getElementById("proceedToOrderBtn").disabled = true;
        document.getElementById("proceedToOrderBtn").style.opacity = 0.5;
    } else {
        document.getElementById("emptyListMsg").style.display = 'none';
        document.getElementById("proceedToOrderBtn").disabled = false;
        document.getElementById("proceedToOrderBtn").style.opacity = 1;
    }

    calculateTotal();
}

function showSuggestions() {
    const input = document.getElementById("smartSearchInput").value.toLowerCase().trim();
    const suggestionsBox = document.getElementById("searchSuggestions");
    suggestionsBox.innerHTML = "";

    if (input.length < 2) return;

    const filtered = productCatalog.filter(p => 
        p.name.toLowerCase().includes(input) || 
        p.aliases.some(alias => alias.includes(input))
    ).filter(p => !smartBulkList.some(item => item.productID === p.id)); 

    if (filtered.length > 0) {
        filtered.forEach(p => {
            const item = document.createElement('div');
            item.classList.add('suggestion-item');
            item.innerText = `${p.name} (${p.unit} рдореЗрдВ тВ╣${p.price.toFixed(2)})`; 
            item.onclick = () => addItemToList(p.id);
            suggestionsBox.appendChild(item);
        });
        suggestionsBox.style.display = 'block';
    } else {
         suggestionsBox.innerHTML = '<div class="suggestion-item" style="color:#999;">рдХреЛрдИ рдкреНрд░реЛрдбрдХреНрдЯ рдирд╣реАрдВ рдорд┐рд▓рд╛ рдпрд╛ рдкрд╣рд▓реЗ рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред</div>';
         suggestionsBox.style.display = 'block';
    }
}

function addItemToList(productID) {
    const product = productCatalog.find(p => p.id === productID);
    if (!product || smartBulkList.some(item => item.productID === productID)) return;

    smartBulkList.push({ productID: productID, qty: 1, total: product.price });
    document.getElementById("smartSearchInput").value = ''; 
    document.getElementById("searchSuggestions").innerHTML = '';
    document.getElementById("searchSuggestions").style.display = 'none';
    renderSmartList(); 
}

function updateQuantity(productID, newQty) {
    const qty = parseInt(newQty);
    if (isNaN(qty) || qty <= 0) {
        const inputElement = document.querySelector(`.bulk-item[data-id="${productID}"] input[type="number"]`);
        if (inputElement) inputElement.value = 1;
        
        const item = smartBulkList.find(i => i.productID === productID);
        if (item) item.qty = 1;
    } else {
        const item = smartBulkList.find(i => i.productID === productID);
        if (item) item.qty = qty;
    }
    renderSmartList(); 
}

function removeItemFromList(productID) {
    smartBulkList = smartBulkList.filter(item => item.productID !== productID);
    renderSmartList(); 
}

/* ================== ЁЯУЭ Buy Product List (Free-Form) Calculator (No Change) ================== */

function calculateFreeFormTotal() {
    const listText = document.getElementById('freeFormList').value;
    const lines = listText.split('\n').map(line => line.trim()).filter(line => line.length > 0);
    let grandTotal = 0;
    const regex = /(\d+\.?\d*)\s*(kg|g|ltr|ml|piece|pc|pcs|pce|pces)?\s*(.*)/i;

    lines.forEach(line => {
        const match = line.match(regex);
        let qty = 1;
        let unitText = 'Piece';
        let prodName = line;

        if (match) {
            qty = parseFloat(match[1]) || 1;
            unitText = (match[2] || 'Piece').toLowerCase();
            prodName = match[3] ? match[3].trim() : line;
        }

        prodName = prodName.toLowerCase().replace(/powder|packet|pouch|box|tin|bottle|pack|purity/g, '').trim();

        let bestMatch = null;
        let bestScore = 0;

        productCatalog.forEach(p => {
            const catalogName = p.name.toLowerCase();
            const keywords = [...p.aliases, catalogName];
            let currentScore = 0;

            keywords.forEach(keyword => {
                if (prodName.includes(keyword) && keyword.length > 2) {
                    currentScore = Math.max(currentScore, keyword.length); 
                }
            });
            
            if (currentScore > bestScore) {
                bestScore = currentScore;
                bestMatch = p;
            }
        });

        if (bestMatch) {
            let convertedQty = qty;
            const targetUnit = bestMatch.unit.toLowerCase();
            
            const isGram = unitText.startsWith('g');
            const isML = unitText.startsWith('ml');
            const isPiece = unitText.startsWith('piece') || unitText.startsWith('pc');

            if (targetUnit === 'kg' && isGram) {
                convertedQty = qty / 1000;
            } else if (targetUnit === 'ltr' && isML) {
                convertedQty = qty / 1000;
            } else if (targetUnit === 'piece' && !isPiece) {
                convertedQty = qty; 
            }
            
            const lineTotal = bestMatch.price * convertedQty;
            grandTotal += lineTotal;
        }
    });

    document.getElementById('freeFormTotalDisplay').innerText = `тВ╣${grandTotal.toFixed(2)}`
    return grandTotal;
}


/* ================== тмЖя╕П рдСрд░реНрдбрд░ рд▓реЙрдЬрд┐рдХ (Updated to call saveData) тмЖя╕П ================== */
function openFinalOrderModal(type) {
    currentOrderType = type;
    document.getElementById('modalPriceRow').style.display = 'none';
    document.getElementById('bulkOrderSummaryInModal').style.display = 'none';
    document.getElementById('freeFormListSummaryInModal').style.display = 'none';

    if (type === 'smart') {
        const total = calculateTotal();
        if (total <= 0) {
            return alert("рдХреГрдкрдпрд╛ рдЕрдкрдиреА рд▓рд┐рд╕реНрдЯ рдореЗрдВ рдХреБрдЫ рдЖрдЗрдЯрдо рдЬреЛрдбрд╝реЗрдВ рдЬрд┐рдирдХреА рдорд╛рддреНрд░рд╛ 1 рдпрд╛ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛред");
        }
        
        document.getElementById('bulkOrderSummaryInModal').style.display = 'block';
        document.getElementById("orderTitle").innerText = "рдмрд▓реНрдХ рдЧреНрд░реЛрд╕рд░реА рдСрд░реНрдбрд░ (Bulk Grocery Order)";
        document.getElementById("modalBulkTotalDisplay").innerText = `тВ╣${total.toFixed(2)}`;

        const detailsList = document.getElementById("bulkOrderDetailsList");
        const productNameLines = [];
        
        detailsList.innerHTML = smartBulkList.map(item => {
            const product = productCatalog.find(p => p.id === item.productID);
            const line = `${product.name}: ${item.qty} ${product.unit} (тВ╣${item.total.toFixed(2)})`;
            productNameLines.push(line);
            return `<p style="margin: 5px 0; font-size: 14px;">${line}</p>`;
        }).join('');

        currentOrderingProduct = {
            id: 'SMART_BULK',
            name: productNameLines.join('\n'), 
            originalPrice: total,
            discount: 0,
            unit: 'List' 
        };

    } else if (type === 'freeform') {
        const freeFormListText = document.getElementById('freeFormList').value.trim();
        const calculatedTotal = calculateFreeFormTotal(); 
        
        if (freeFormListText.length === 0) {
            return alert("рдЖрдкрдХреА рдЦрд░реАрджрджрд╛рд░реА рд╕реВрдЪреА рдЦрд╛рд▓реА рд╣реИред рдХреГрдкрдпрд╛ рдЖрдЗрдЯрдо рд▓рд┐рдЦреЗрдВред");
        }
        
        document.getElementById('freeFormListSummaryInModal').style.display = 'block';
        document.getElementById("orderTitle").innerText = "рдЦрд░реАрджрджрд╛рд░реА рд╕реВрдЪреА рдСрд░реНрдбрд░ (Free-Form Product List)";
        document.getElementById("modalFreeFormListDisplay").innerText = freeFormListText;
        
        document.getElementById('modalFreeFormPriceDisplay').innerText = `тВ╣${calculatedTotal.toFixed(2)}`;
        
        const tbdMsg = document.getElementById('freeFormTBDMessage');
        tbdMsg.style.display = calculatedTotal > 0 ? 'block' : 'block'; 
        
        currentOrderingProduct = {
            id: 'FREE_FORM',
            name: freeFormListText, 
            originalPrice: calculatedTotal, 
            discount: 0,
            unit: 'List' 
        };
    }

    document.getElementById("orderFormModal").style.display = "flex";
}


document.getElementById("confirmOrder").onclick=()=>{
  const name = document.getElementById("custName").value;
  const mobile = document.getElementById("custMobile").value;
  const flat = document.getElementById("custFlat").value;
  const village = document.getElementById("custVillage").value;
  const district = document.getElementById("custDistrict").value;
  const pincode = document.getElementById("custPincode").value;
  const state = document.getElementById("custState").value;
  
  if (!name || !mobile || !flat || !village || !district || !pincode || !state) {
      return alert("рдХреГрдкрдпрд╛ рдСрд░реНрдбрд░ рдлреЙрд░реНрдо рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА (рдирд╛рдо, рдореЛрдмрд╛рдЗрд▓, рдкрддрд╛, рдЖрджрд┐) рднрд░реЗрдВ!");
  }

  let total = 0;
  let productName = "";
  let qtyUnit = "";
  let status = "";
  let orderPrefix = 'SRM'; // Unique prefix for new orders

  if (currentOrderType === 'single') {
    const qty = document.getElementById("custQuantity").value;
    const unit = document.getElementById("unitSelector").value;
    if (!qty || parseFloat(qty) <= 0) return alert("рдХреГрдкрдпрд╛ рд╕рд╣реА рдорд╛рддреНрд░рд╛ (Quantity) рджрд░реНрдЬ рдХрд░реЗрдВ!");

    const price = (currentOrderingProduct.originalPrice * (100 - currentOrderingProduct.discount) / 100);
    total = (price * parseFloat(qty)).toFixed(2);
    productName = currentOrderingProduct.name;
    qtyUnit = `${qty} ${unit}`;
    status = 'New Order';
    
  } else if (currentOrderType === 'smart') {
    total = currentOrderingProduct.originalPrice.toFixed(2);
    productName = "рд╕реНрдорд╛рд░реНрдЯ рдЧреНрд░реЛрд╕рд░реА рд▓рд┐рд╕реНрдЯ:\n" + currentOrderingProduct.name;
    qtyUnit = `${smartBulkList.length} Items (Total: тВ╣${total})`;
    status = 'New Order';

    smartBulkList = [];
    renderSmartList();

  } else if (currentOrderType === 'freeform') {
    total = currentOrderingProduct.originalPrice.toFixed(2); 
    productName = "рдЦрд░реАрджрджрд╛рд░реА рд╕реВрдЪреА:\n" + currentOrderingProduct.name;
    const totalLines = currentOrderingProduct.name.split('\n').filter(line => line.trim().length > 0).length;
    
    if (parseFloat(total) > 0) {
        qtyUnit = `${totalLines} Lines (Price: тВ╣${total} Estimated)`;
        status = 'New Order (Price Estimated)';
    } else {
        qtyUnit = `${totalLines} Lines (Price TBD)`;
        status = 'New Order (Price TBD)';
    }
    
    document.getElementById('freeFormList').value = '';
    document.getElementById('freeFormTotalDisplay').innerText = `тВ╣0.00`; 
  }
  
  // Create a unique ID: SRM + timestamp (or order count for simplicity)
  const newOrderId = orderPrefix + (orders.length + 101);
  const fullAddress = `рдлреНрд▓реИрдЯ/рд░реВрдо: ${flat}, рдЧрд╛рдБрд╡: ${village}, рдЬрд┐рд▓рд╛: ${district}, рдкрд┐рди: ${pincode}, рд░рд╛рдЬреНрдп: ${state}`;
  

  orders.unshift({ 
    id: newOrderId, 
    product: productName, 
    qty: qtyUnit, 
    name: name, 
    mobile: mobile,
    address: fullAddress,
    total: (parseFloat(total) > 0 ? parseFloat(total).toFixed(2) : 'TBD'), 
    status: status 
  });
  
  // тнР NEW: Save the updated orders data
  saveData(); 
  
  let orderConfirmMsg = `тЬЕ рдмрдзрд╛рдИ! рдЖрдкрдХрд╛ рдСрд░реНрдбрд░ ${newOrderId} рдХрдиреНрдлрд░реНрдо рд╣реБрдЖред \nрдЙрддреНрдкрд╛рдж: ${productName.substring(0, 50)}...\nрдирд╛рдо: ${name}\nрдореЛрдмрд╛рдЗрд▓: ${mobile}\n`;
  
  if (parseFloat(total) > 0) {
      orderConfirmMsg += `рдЕрдиреБрдорд╛рдирд┐рдд рдХреАрдордд: тВ╣${total}\n`;
      if (currentOrderType !== 'single') {
        orderConfirmMsg += `(рдиреЛрдЯ: рдпрд╣ Buy Product List рдХрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдореВрд▓реНрдп рд╣реИред рдЕрдВрддрд┐рдо рдореВрд▓реНрдп рдбрд┐рд▓реАрд╡рд░реА рдХреЗ рд╕рдордп рдХрдиреНрдлрд░реНрдо рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред)\n`;
      }
  } else {
      orderConfirmMsg += `рдХреБрд▓ рдХреАрдордд: рдбрд┐рд▓реАрд╡рд░реА рдХреЗ рд╕рдордп рдмрддрд╛рдИ рдЬрд╛рдПрдЧреАред`;
  }
  alert(orderConfirmMsg);
  
  closeModal('orderFormModal');
  loadMyOrders(); 
};

/* ================== ЁЯФС рдПрдбрдорд┐рди рд▓реЙрдЬрд┐рдХ (Updated to call saveData) ЁЯФС ================== */
function openAdminCatalogModal(){
    const pass = prompt("рдЧреНрд░реЛрд╕рд░реА рдХреИрдЯрд▓реЙрдЧ рдПрдбрдорд┐рди рдкрд╛рд╕рд╡рд░реНрдб рдбрд╛рд▓реЗрдВ:");
    if (pass !== CATALOG_ADMIN_PASS) {
        return alert("тЭМ рдЧрд▓рдд рдкрд╛рд╕рд╡рд░реНрдб! рдЖрдк рдХреИрдЯрд▓реЙрдЧ рдореИрдиреЗрдЬ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред");
    }
    closeModal('adminPanelModal'); 
    document.getElementById("catalogCount").innerText = productCatalog.length;
    document.getElementById("adminCatalogModal").style.display="flex";
}

document.getElementById("confirmAddCatalogProd").onclick=()=>{
  const name = document.getElementById("newCatProdName").value.trim();
  const price = parseFloat(document.getElementById("newCatProdPrice").value);
  const unit = document.getElementById("newCatProdUnit").value;
  const aliasesString = document.getElementById("newCatProdAliases").value.toLowerCase();
  
  if (!name || isNaN(price) || price <= 0) {
      return alert("рдХреГрдкрдпрд╛ рдирд╛рдо рдФрд░ рд╕рд╣реА рдХреАрдордд рднрд░реЗрдВ! (Name and correct price are required!)");
  }
  
  const aliases = aliasesString.split(',').map(a => a.trim()).filter(a => a.length > 0);
  aliases.unshift(name.toLowerCase().trim());

  if(productCatalog.some(p => p.name.trim().toLowerCase() === name.toLowerCase().trim())){
      return alert(`тЭМ рдпрд╣ рдкреНрд░реЛрдбрдХреНрдЯ (${name}) рдкрд╣рд▓реЗ рд╕реЗ рдХреИрдЯрд▓реЙрдЧ рдореЗрдВ рдореМрдЬреВрдж рд╣реИ!`);
  }

  const newId = productCatalog.length > 0 ? productCatalog[productCatalog.length - 1].id + 1 : 1011;
  
  productCatalog.push({ id: newId, name, unit, price, aliases });
  
  // тнР NEW: Save the updated catalog data
  saveData();
  
  alert(`тЬЕ рдХреИрдЯрд▓реЙрдЧ рдореЗрдВ рдирдпрд╛ рдкреНрд░реЛрдбрдХреНрдЯ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛: ${name} (рдХреАрдордд: тВ╣${price}/${unit}) \nрдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛ рд╣реИ!`);
  
  document.getElementById("newCatProdName").value = '';
  document.getElementById("newCatProdPrice").value = '';
  document.getElementById("newCatProdAliases").value = '';
  document.getElementById("catalogCount").innerText = productCatalog.length;
};

document.getElementById("removeCatProdBtn").onclick=()=>{
    const name=prompt("рд╡рд╣ рдкреНрд░реЛрдбрдХреНрдЯ рдирд╛рдо рд▓рд┐рдЦреЗрдВ рдЬрд┐рд╕реЗ рдХреИрдЯрд▓реЙрдЧ рд╕реЗ рд╣рдЯрд╛рдирд╛ рд╣реИ: (Enter Product Name to delete from Catalog):");
    if (!name) return;
    
    const initialLength = productCatalog.length;
    productCatalog = productCatalog.filter(p => p.name.toLowerCase().trim() !== name.toLowerCase().trim());
    
    if(productCatalog.length < initialLength){
        // тнР NEW: Save the updated catalog data
        saveData();
        alert(`рдХреИрдЯрд▓реЙрдЧ рдкреНрд░реЛрдбрдХреНрдЯ рд╣рдЯрд╛рдпрд╛ рдЧрдпрд╛: ${name} тЭМ (рдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛ рд╣реИ!)`);
        document.getElementById("catalogCount").innerText = productCatalog.length;
    } else alert("рдкреНрд░реЛрдбрдХреНрдЯ рдирд╛рдо рдХреИрдЯрд▓реЙрдЧ рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓рд╛! (Product name not found!)");
};

// тнР NEW: рдСрд░реНрдбрд░ рд╕реНрдЯреЗрдЯрд╕ рдмрджрд▓рдиреЗ рдХрд╛ рдлрдВрдХреНрд╢рди
document.getElementById("updateOrderStatusBtn").onclick=()=>{
    closeModal('adminPanelModal');
    document.getElementById('updateStatusModal').style.display = 'flex';
};

document.getElementById("confirmStatusUpdate").onclick=()=>{
    const orderId = document.getElementById("updateOrderId").value.trim();
    const newStatus = document.getElementById("newStatusSelector").value;
    
    if (!orderId || !newStatus) return alert("рдХреГрдкрдпрд╛ рдСрд░реНрдбрд░ ID рдФрд░ рдирдИ рд╕реНрдерд┐рддрд┐ рдЪреБрдиреЗрдВ!");
    
    const orderIndex = orders.findIndex(o => o.id.toUpperCase() === orderId.toUpperCase());
    
    if (orderIndex === -1) return alert(`рдСрд░реНрдбрд░ ID ${orderId} рдирд╣реАрдВ рдорд┐рд▓рд╛!`);

    orders[orderIndex].status = newStatus;
    
    // тнР NEW: Save the updated orders data
    saveData();
    
    alert(`рдСрд░реНрдбрд░ ${orderId} рдХреА рд╕реНрдерд┐рддрд┐ рдЕрдкрдбреЗрдЯ рд╣реБрдИ: ${newStatus} тЬЕ (рдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛ рд╣реИ!)`);
    document.getElementById("updateOrderId").value = '';
    closeModal('updateStatusModal');
    loadMyOrders();
};


/* ================== рд╕рд╛рдорд╛рдиреНрдп рдПрдбрдорд┐рди рдФрд░ рдЕрдиреНрдп рдлрдВрдХреНрд╢рди ================== */


function loadProducts(){
  productContainer.innerHTML="";
  products.forEach((p)=>{
    const discountedPrice = (p.originalPrice * (100 - p.discount) / 100).toFixed(2);
    const div=document.createElement("div");
    div.classList.add("product");
    div.setAttribute('data-product-id', p.id);
    // тнР NEW: p.img рдореЗрдВ рдЕрдм Base64 рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЛрдЧреА
    const imgSrc = p.img || "https://via.placeholder.com/200"; 

    div.innerHTML=`
      <img src="${imgSrc}" alt="${p.name}" onclick="openOrderModal(${p.id})">
      <div class="product-details">
        <h4 onclick="openOrderModal(${p.id})" title="${p.name}">${p.name}</h4>
        <div class="price-box">
          <span class="original-price">тВ╣${p.originalPrice.toFixed(2)}/${p.unit}</span>
          <span class="discounted-price" onclick="alert('рдпрд╣ рдЙрддреНрдкрд╛рдж тВ╣${discountedPrice} рдХрд╛ рд╣реИ, рдЬрд┐рд╕ рдкрд░ ${p.discount}% рдбрд┐рд╕реНрдХрд╛рдЙрдВрдЯ рд╣реИред')">тВ╣${discountedPrice}/${p.unit}</span>
        </div>
        ${p.discount > 0 ? `<div class="discount-badge">${p.discount}% OFF</div>` : ''}
        <button class="order-btn" onclick="openOrderModal(${p.id})">рдСрд░реНрдбрд░ рдХрд░реЗрдВ (Order Now)</button>
      </div>`;
    productContainer.appendChild(div);
  });
}


function loadMyOrders() {
    const container = document.getElementById("myOrdersContainer");
    container.innerHTML = ""; 
    
    if (orders.length === 0) {
        container.innerHTML = '<p style="text-align: center; margin-top: 20px; color: #999;">рдЖрдкрдХрд╛ рдХреЛрдИ рдСрд░реНрдбрд░ рдирд╣реАрдВ рд╣реИред</p>';
        return;
    }

    orders.forEach(order => {
        const orderBox = document.createElement('div');
        orderBox.classList.add('order-summary');
        orderBox.style.borderLeftColor = order.status.includes('New') ? 'var(--primary-color)' : (order.status.includes('Delivery') ? '#FF9800' : (order.status.includes('Complete') ? 'var(--secondary-color)' : '#D32F2F'));
        orderBox.innerHTML = `
            <h4>рдСрд░реНрдбрд░ ID: ${order.id}</h4>
            <p>рдЙрддреНрдкрд╛рдж (Product): <strong>${order.product.replace(/\n/g, '<br>')}</strong></p>
            <p>рдорд╛рддреНрд░рд╛ (Quantity): <strong>${order.qty}</strong></p>
            <p>рдХреБрд▓ рдХреАрдордд (Total Price): <strong>${order.total !== 'TBD' ? 'тВ╣' + parseFloat(order.total).toFixed(2) : 'рдХреАрдордд рдмрд╛рдж рдореЗрдВ рдмрддрд╛рдИ рдЬрд╛рдПрдЧреА (Price TBD)'}</strong></p>
            <p>рд╕реНрдерд┐рддрд┐ (Status): <strong>${order.status}</strong></p>
        `;
        container.appendChild(orderBox);
    });
}
function closeModal(id){
    document.getElementById(id).style.display = 'none';
    if(id === 'orderFormModal'){
        document.getElementById('modalPriceRow').style.display = 'block';
        document.getElementById('singleQtyUnitSelector').style.display = 'inline';
        document.getElementById('bulkOrderSummaryInModal').style.display = 'none';
        document.getElementById('freeFormListSummaryInModal').style.display = 'none';
        currentOrderType = 'single';
    }
}
function adminLogout(){
  closeModal('adminPanelModal');
  document.getElementById("loginBox").style.display="block";
  document.getElementById("adminMenu").style.display="none";
}
document.getElementById("loginBtn").onclick=()=>{
  const pass=document.getElementById("adminPass").value;
  if(pass===MAIN_ADMIN_PASS){ 
    document.getElementById("loginBox").style.display="none";
    document.getElementById("adminMenu").style.display="block";
  } else alert("рдЧрд▓рдд рдкрд╛рд╕рд╡рд░реНрдб! (Wrong Password!)");
};
document.getElementById("adminIcon").onclick=()=>{
  document.getElementById("adminPanelModal").style.display="flex";
};
function openOrderModal(productId){
  const product = products.find(p => p.id === productId);
  if (!product) return alert("рдЙрддреНрдкрд╛рдж рдирд╣реАрдВ рдорд┐рд▓рд╛! (Product not found!)");
  currentOrderingProduct = product;
  currentOrderType = 'single';
  
  document.getElementById('modalPriceRow').style.display = 'flex';
  document.getElementById('singleQtyUnitSelector').style.display = 'inline';
  document.getElementById('bulkOrderSummaryInModal').style.display = 'none';
  document.getElementById('freeFormListSummaryInModal').style.display = 'none';

  const discountedPrice = (product.originalPrice * (100 - product.discount) / 100).toFixed(2);
  document.getElementById("orderTitle").innerText = product.name + " - рдСрд░реНрдбрд░ рдлреЙрд░реНрдо";
  document.getElementById("modalPriceDisplay").innerText = `тВ╣${discountedPrice} / ${product.unit}`;
  document.getElementById("custQuantity").value = 1;
  document.getElementById("unitSelector").innerHTML = `<option value="${product.unit}">${product.unit}</option>`;
  document.getElementById("unitSelector").value = product.unit;
  document.getElementById("unitSelector").disabled = true; 
  document.getElementById("orderFormModal").style.display="flex";
}

document.getElementById("addProdBtn").onclick=()=>{
    closeModal('adminPanelModal');
    document.getElementById('addProductModal').style.display = 'flex';
};
document.getElementById("confirmAddProd").onclick=()=>{
  const name = document.getElementById("newProdName").value;
  const fileInput = document.getElementById("newProdFile");
  const price = parseFloat(document.getElementById("newProdOriginalPrice").value);
  const discount = parseInt(document.getElementById("newProdDiscount").value) || 0;
  const unit = document.getElementById("newProdUnit").value;
  
  if (fileInput.files.length === 0) return alert("рдХреГрдкрдпрд╛ рдкреНрд░реЛрдбрдХреНрдЯ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ! (Please upload product photo!)");
  if (!name || isNaN(price) || price <= 0) return alert("рдирд╛рдо рдФрд░ рд╕рд╣реА рдХреАрдордд рдЬрд╝рд░реВрд░реА рд╣реИ! (Name and correct price are required!)");
  
  const file = fileInput.files[0];
  
  // тнР NEW: Convert file to Base64 for permanent storage
  const reader = new FileReader();
  reader.onload = function(e) {
      const base64Img = e.target.result; // Base64 string is the persistent URL
      
      products.unshift({
          id: Date.now(), 
          name, 
          originalPrice: price, 
          discount, 
          unit, 
          img: base64Img // Store Base64
      });
      
      // тнР NEW: Save the updated products data
      saveData();
      loadProducts();
      alert(`рдирдпрд╛ рдкреНрд░реЛрдбрдХреНрдЯ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛: ${name} тЬЕ \nрдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛ рд╣реИ!`);
      closeModal('addProductModal');
      document.getElementById("newProdName").value = '';
      document.getElementById("newProdFile").value = '';
      document.getElementById("newProdOriginalPrice").value = '';
      document.getElementById("newProdDiscount").value = 0;
  };
  reader.readAsDataURL(file); // Read as data URL (Base64)
};


document.getElementById("delProdBtn").onclick=()=>{
  const name=prompt("рд╡рд╣ рдкреНрд░реЛрдбрдХреНрдЯ рдирд╛рдо рд▓рд┐рдЦреЗрдВ рдЬрд┐рд╕реЗ рд╣рдЯрд╛рдирд╛ рд╣реИ: (Enter Product Name to delete):");
  if (!name) return;
  
  const initialLength = products.length;
  products = products.filter(p => p.name !== name);
  
  if(products.length < initialLength){
    // тнР NEW: Save the updated products data
    saveData(); 
    loadProducts();
    alert(`рдкреНрд░реЛрдбрдХреНрдЯ рд╣рдЯрд╛рдпрд╛ рдЧрдпрд╛: ${name} тЭМ (рдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛ рд╣реИ!)`);
  } else alert("рдкреНрд░реЛрдбрдХреНрдЯ рдирд╛рдо рд╕реВрдЪреА рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓рд╛! (Product name not found!)");
};

document.getElementById("removeOrderBtn").onclick=()=>{
    const orderId = prompt("рд╡рд╣ рдСрд░реНрдбрд░ ID (рдЬреИрд╕реЗ SRM101) рд▓рд┐рдЦреЗрдВ рдЬрд┐рд╕реЗ рд╣рдЯрд╛рдирд╛ рд╣реИ: (Enter Order ID to remove):");
    if (!orderId) return;
    const initialLength = orders.length;
    orders = orders.filter(o => o.id.toUpperCase() !== orderId.toUpperCase());
    
    if(orders.length < initialLength){
        // тнР NEW: Save the updated orders data
        saveData();
        alert(`рдСрд░реНрдбрд░ рд╣рдЯрд╛рдпрд╛ рдЧрдпрд╛: ${orderId} тЭМ (рдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛ рдЧрдпрд╛ рд╣реИ!)`);
        loadMyOrders(); 
    } else alert("рдСрд░реНрдбрд░ ID рд╕реВрдЪреА рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓рд╛! (Order ID not found!)");
};

document.getElementById("printOrders").onclick=()=>{
  closeModal('adminPanelModal');
  const newOrders = orders.filter(o => o.status.includes('New Order'));
  if (newOrders.length === 0) {
      return alert("рдХреЛрдИ рдирдпрд╛ рдСрд░реНрдбрд░ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ! (No new orders to print!)");
  }
  const printWindow = window.open('', '', 'height=700,width=900');
  let orderHtml = `
    <html>
    <head><title>SHREE RAM MARKET - Order Print</title>
    <style>
      body{font-family: Arial, sans-serif; padding: 20px;}
      table{width:100%; border-collapse:collapse; margin-top:20px;} 
      th,td{border:1px solid #333; padding:10px; text-align:left; font-size:14px;} 
      th{background:#ff5c33; color:white;}
      h1{color:#ff5c33; border-bottom: 2px solid #ff5c33; padding-bottom: 5px;}
      .order-box{border:2px solid #333; padding:15px; margin-bottom:15px; border-radius:8px;}
      .order-product-list{white-space: pre-wrap; margin-top: 10px; padding: 10px; border: 1px dashed #ccc;}
    </style>
    </head>
    <body>
    <h1>ЁЯз╛ SHREE RAM MARKET - рдирдП рдСрд░реНрдбрд░реНрд╕ рдкреНрд░рд┐рдВрдЯ рд░рд┐рдкреЛрд░реНрдЯ (New Orders Print Report)</h1>
    <p>рдХреБрд▓ рдирдП рдСрд░реНрдбрд░реНрд╕ (Total New Orders): ${newOrders.length}</p>
    <p>рддрд╛рд░реАрдЦ (Date): ${new Date().toLocaleDateString('hi-IN')}</p>
    <hr>
    ${newOrders.map(o => `
      <div class="order-box">
        <h3>рдСрд░реНрдбрд░ ID: ${o.id}</h3>
        <p><strong>рдЙрддреНрдкрд╛рдж рдФрд░ рдорд╛рддреНрд░рд╛:</strong> ${o.qty}</p>
        <div class="order-product-list">
          ${o.product} 
        </div>
        <p><strong>рдХреБрд▓ рдХреАрдордд (Total Price):</strong> ${o.total !== 'TBD' ? 'тВ╣' + parseFloat(o.total).toFixed(2) : 'рдХреАрдордд рдмрд╛рдж рдореЗрдВ рдмрддрд╛рдИ рдЬрд╛рдПрдЧреА'}</p>
        <p><strong>рдЧреНрд░рд╛рд╣рдХ (Customer):</strong> ${o.name} | <strong>рдореЛрдмрд╛рдЗрд▓ (Mobile):</strong> ${o.mobile}</p>
        <p><strong>рдкрддрд╛ (Address):</strong> ${o.address}</p>
      </div>
    `).join('')}
    <p style="margin-top: 30px; text-align: center;">--- SHREE RAM MARKET ---</p>
    </body></html>`;
  printWindow.document.write(orderHtml);
  printWindow.document.close();
  printWindow.focus();
  printWindow.print();
};

function showSection(id) {
    document.querySelectorAll('.content-section').forEach(section => {
        section.style.display = 'none';
    });
    document.getElementById(id).style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

window.onload = function() {
  // тнР NEW: рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░реЗрдВ
  loadData(); 
  
  loadProducts();
  loadMyOrders(); 
  renderSmartList(); 
  
  calculateFreeFormTotal(); 

  document.getElementById("catalogCount").innerText = productCatalog.length;

  document.addEventListener('click', (event) => {
    const suggestionsBox = document.getElementById("searchSuggestions");
    const searchInput = document.getElementById("smartSearchInput");
    
    if (!searchInput.contains(event.target) && !suggestionsBox.contains(event.target)) {
        suggestionsBox.style.display = 'none';
    }
  });

};
</script>

</body>
</html>
